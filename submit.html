<!DOCTYPE html>
<html lang="ta">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TamilGeo - Submit Post</title>

  <!-- ‚úÖ Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- ‚úÖ Font Awesome 6.5.2 -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
    integrity="sha512-MC6E5vbeSFRYxuVXWaJjXKQn5SC2eYyEUZ+cfYY4gXavwhC2EeUlDRt7rkKHlf6IikIfZngjRvmhYlZ4m+Oc7Q=="
    crossorigin="anonymous"
    referrerpolicy="no-referrer"
  />

<!-- ‚úÖ Quill.js CSS (for rich text editor) -->
  <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
</head>
<body class="bg-gray-100 text-gray-900 min-h-screen flex flex-col">

  <style>
    .floating-footer {
      backdrop-filter: blur(14px);
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.15);
    }
    .card {
      transition: all 0.4s ease;
      background: linear-gradient(145deg, rgba(255,255,255,0.05), rgba(255,255,255,0.02));
      border: 1px solid rgba(255,255,255,0.1);
    }
    .card:hover {
      transform: translateY(-6px) scale(1.02);
      box-shadow: 0 15px 35px rgba(0, 255, 200, 0.4);
      border-color: rgba(0,255,200,0.4);
    }
  </style>
</head>
<body class="bg-gradient-to-br from-gray-900 via-gray-800 to-black text-white flex flex-col min-h-screen font-sans">

  <!-- ‚úÖ Shared Header -->
  <div id="shared-header"></div>

  <main class="max-w-5xl mx-auto p-6 flex-grow grid grid-cols-1 lg:grid-cols-2 gap-6">
    <div>
      <h1 class="text-3xl font-bold mb-6">‚úç Submit a Post</h1>

      <!-- üìú General Rules -->
      <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-6 rounded">
        <h2 class="text-lg font-semibold mb-2">üìå Rules to be Followed</h2>
        <ul class="list-disc pl-6 space-y-1 text-gray-700 text-sm">
          <li>Posts must be original and relevant to the community.</li>
          <li>No offensive, abusive, or misleading content.</li>
          <li>Posts can be edited or deleted during review by the admin.</li>
          <li>Ensure the content is factually accurate before submitting.</li>
          <li>Respect copyright laws when using text or images.</li>
        </ul>
      </div>

      <form id="postForm" class="bg-white p-6 rounded shadow">
        <input type="text" id="title" placeholder="Post Title" class="w-full p-2 border rounded mb-4" required>

        <select id="category" class="w-full p-2 border rounded mb-4" required>
          <option value="">Select Category</option>
          <option value="News">News</option>
          <option value="Education">Education</option>
          <option value="Technology">Technology</option>
          <option value="Entertainment">Entertainment</option>
          <option value="Other">Other</option>
        </select>

        <input type="text" id="tags" placeholder="Tags (comma separated)" class="w-full p-2 border rounded mb-4">

        <textarea id="excerpt" placeholder="Short Description / Excerpt" class="w-full p-2 border rounded mb-4" rows="3" required></textarea>

        <input type="text" id="author" class="w-full p-2 border rounded mb-4 bg-gray-100" readonly>

        <div id="editor-container" class="w-full mb-4 border rounded"></div>

        <input type="url" id="image" placeholder="Image URL (optional)" class="w-full p-2 border rounded mb-4">

        <label class="flex items-center mb-4 text-sm text-gray-700">
          <input type="checkbox" id="acceptRules" class="mr-2" required>
          I have read and agree to the above rules.
        </label>

        <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded">Submit</button>
      </form>
    </div>

    <!-- ‚úÖ Live Preview Panel -->
    <div>
      <h2 class="text-2xl font-bold mb-4">üëÅÔ∏è Live Preview</h2>
      <div id="preview" class="bg-white p-4 rounded shadow space-y-4">
        <h3 id="preview-title" class="text-xl font-semibold"></h3>
        <p id="preview-category" class="text-sm text-gray-500"></p>
        <p id="preview-excerpt" class="text-gray-700"></p>
        <img id="preview-image" src="" alt="" class="w-full max-h-60 object-cover rounded hidden">
        <div id="preview-content" class="prose max-w-full"></div>
        <p class="text-xs text-gray-400">Author: <span id="preview-author"></span></p>
        <p class="text-xs text-gray-400">Tags: <span id="preview-tags"></span></p>
      </div>
    </div>
  </main>

<body class="bg-gradient-to-br from-gray-900 via-gray-800 to-black text-white flex flex-col min-h-screen font-sans pb-24">

<div id="footer"></div>
<script type="module" src="assets/js/header.js"></script>
<script type="module" src="assets/js/footer.js"></script>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
    import { getDatabase, ref, push, set } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDt86oFFa-h04TsfMWSFGe3UHw26WYoR-U",
      authDomain: "tamilgeoapp.firebaseapp.com",
      databaseURL: "https://tamilgeoapp-default-rtdb.firebaseio.com",
      projectId: "tamilgeoapp",
      storageBucket: "tamilgeoapp.appspot.com",
      messagingSenderId: "1092623024431",
      appId: "1:1092623024431:web:ea455dd68a9fcf480be1da"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getDatabase(app);

    const postForm = document.getElementById("postForm");
    const authorInput = document.getElementById("author");

    // Quill editor
    var quill = new Quill('#editor-container', {
      theme: 'snow',
      modules: {
        toolbar: [
          [{ 'header': '1' }, { 'header': '2' }, { 'font': [] }],
          [{ 'list': 'ordered'}, { 'list': 'bullet' }],
          ['bold', 'italic', 'underline', 'strike'],
          [{ 'color': [] }, { 'background': [] }],
          [{ 'align': [] }],
          ['link'],
          ['blockquote'],
          ['code-block']
        ]
      }
    });

    // Preview elements
    const previewTitle = document.getElementById("preview-title");
    const previewCategory = document.getElementById("preview-category");
    const previewExcerpt = document.getElementById("preview-excerpt");
    const previewContent = document.getElementById("preview-content");
    const previewImage = document.getElementById("preview-image");
    const previewAuthor = document.getElementById("preview-author");
    const previewTags = document.getElementById("preview-tags");

    function updatePreview() {
      previewTitle.textContent = document.getElementById("title").value;
      previewCategory.textContent = "Category: " + document.getElementById("category").value;
      previewExcerpt.textContent = document.getElementById("excerpt").value;
      const imageUrl = document.getElementById("image").value;
      if(imageUrl) {
        previewImage.src = imageUrl;
        previewImage.classList.remove("hidden");
      } else {
        previewImage.classList.add("hidden");
      }
      previewContent.innerHTML = quill.root.innerHTML;
      previewAuthor.textContent = authorInput.value;
      previewTags.textContent = document.getElementById("tags").value;
    }

    document.getElementById("title").addEventListener("input", updatePreview);
    document.getElementById("category").addEventListener("input", updatePreview);
    document.getElementById("excerpt").addEventListener("input", updatePreview);
    document.getElementById("tags").addEventListener("input", updatePreview);
    document.getElementById("image").addEventListener("input", updatePreview);
    quill.on('text-change', updatePreview);

    onAuthStateChanged(auth, (user) => {
      if (!user) {
        alert("Please log in to submit a post.");
        window.location.href = "/login.html";
        return;
      }

      authorInput.value = user.displayName || user.email;
      updatePreview();

      postForm.addEventListener("submit", (e) => {
        e.preventDefault();

        const title = document.getElementById("title").value.trim();
        const category = document.getElementById("category").value.trim();
        const tags = document.getElementById("tags").value.trim();
        const excerpt = document.getElementById("excerpt").value.trim();
        const content = quill.root.innerHTML.trim();
        const image = document.getElementById("image").value.trim();
        const acceptRules = document.getElementById("acceptRules").checked;

        if (!title || !category || !excerpt || !content) {
          alert("Please fill in all required fields.");
          return;
        }

        if (!acceptRules) {
          alert("You must agree to the rules before submitting.");
          return;
        }

        const postId = push(ref(db, "pendingPosts")).key;
        const postData = {
          title,
          category,
          tags: tags ? tags.split(",").map(t => t.trim()) : [],
          excerpt,
          content,
          image: image || null,
          author: user.displayName || user.email,
          date: Date.now(),
          status: "pending"
        };

        set(ref(db, "pendingPosts/" + postId), postData).then(() => {
          alert("‚úÖ Post submitted for approval!");
          postForm.reset();
          authorInput.value = user.displayName || user.email;
          updatePreview();
        }).catch(err => {
          console.error(err);
          alert("‚ùå Error submitting post.");
        });
      });
    });
  </script>

  <script type="module" src="header.js"></script>
  <footer id="footer" class="mt-auto"></footer>
  <script type="module" src="js/footer.js"></script>
  <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>

<div id="footer"></div>
<script type="module" src="assets/js/header.js"></script>
<script type="module" src="assets/js/footer.js"></script>
</body>
</html>